# ── External Secrets Operator (ESO) Integration ──────────────────────────────
#
# This file provides templates for integrating with various secrets managers.
# Uncomment ONLY ONE of the SecretStore blocks (A, B, C, or D) based on your
# provider, and then use the ExternalSecret resource at the bottom.
#
# Prerequisites:
#   - External Secrets Operator installed (https://external-secrets.io/)
#   - Appropriate credentials/ServiceAccount configured for the chosen provider
# ─────────────────────────────────────────────────────────────────────────────

# ── Option A: HashiCorp Vault ────────────────────────────────────────────────
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: vault-backend
#   namespace: rainlogs
# spec:
#   provider:
#     vault:
#       server: "http://vault.vault.svc.cluster.local:8200"
#       path: "secret"
#       version: "v2"
#       auth:
#         tokenSecretRef:
#           name: vault-token
#           key: token

# ── Option B: AWS Secrets Manager ────────────────────────────────────────────
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: aws-backend
#   namespace: rainlogs
# spec:
#   provider:
#     aws:
#       service: SecretsManager
#       region: eu-central-1
#       auth:
#         secretRef:
#           accessKeyIDSecretRef:
#             name: aws-secret
#             key: access-key
#           secretAccessKeySecretRef:
#             name: aws-secret
#             key: secret-access-key

# ── Option C: Azure Key Vault ────────────────────────────────────────────────
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: azure-backend
#   namespace: rainlogs
# spec:
#   provider:
#     azurekv:
#       tenantId: "your-tenant-id"
#       vaultUrl: "https://your-vault.vault.azure.net"
#       authType: ManagedIdentity

# ── Option D: Infisical ──────────────────────────────────────────────────────
# apiVersion: external-secrets.io/v1beta1
# kind: SecretStore
# metadata:
#   name: infisical-backend
#   namespace: rainlogs
# spec:
#   provider:
#     webhook:
#       url: "http://infisical-agent.infisical.svc.cluster.local/api/v1/secret"
#       method: GET
#       headers:
#         Authorization: "Bearer {{ .token }}"
#       result:
#         jsonPath: "$.secrets"

# ── ExternalSecret Resource ──────────────────────────────────────────────────
# This resource tells ESO to fetch secrets from the configured store and create
# the native 'rainlogs-secret' expected by the application.
#
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: rainlogs-external-secret
#   namespace: rainlogs
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: vault-backend  # ← Change to match your chosen SecretStore name (Option A/B/C/D)
#     kind: SecretStore
#   target:
#     name: rainlogs-secret
#     creationPolicy: Owner
#   data:
#   - secretKey: RAINLOGS_DATABASE_DSN
#     remoteRef:
#       key: rainlogs/prod
#       property: database_dsn
#   - secretKey: RAINLOGS_JWT_SECRET
#     remoteRef:
#       key: rainlogs/prod
#       property: jwt_secret
#   - secretKey: RAINLOGS_KMS_KEY
#     remoteRef:
#       key: rainlogs/prod
#       property: kms_key
