apiVersion: v1
kind: Namespace
metadata:
  name: rainlogs
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: rainlogs-config
  namespace: rainlogs
data:
  POSTGRES_DB: "rainlogs"
  POSTGRES_USER: "rainlogs"
  RAINLOGS_APP_ENV: "production"
  RAINLOGS_APP_PORT: "8080"
  RAINLOGS_DATABASE_DSN: "postgres://rainlogs:changeme@postgres:5432/rainlogs?sslmode=disable"
  RAINLOGS_REDIS_ADDR: "redis:6379"
  RAINLOGS_S3_ENDPOINT: "http://garage:3900"
  RAINLOGS_S3_REGION: "garage"
  RAINLOGS_S3_BUCKET: "rainlogs-logs"
  RAINLOGS_S3_FORCE_PATH_STYLE: "true"
  RAINLOGS_STORAGE_BACKEND: "s3"
  RAINLOGS_STORAGE_FS_ROOT: "/data"
---
# ── Secrets ──────────────────────────────────────────────────────────────────
# Default k8s Secret. For production with External Secrets Operator (ESO),
# skip applying this block and use 35-external-secrets.yaml instead.
# ─────────────────────────────────────────────────────────────────────────────
apiVersion: v1
kind: Secret
metadata:
  name: rainlogs-secret
  namespace: rainlogs
type: Opaque
stringData:
  POSTGRES_PASSWORD: "changeme"
  REDIS_PASSWORD: "changeme"
  RAINLOGS_S3_ACCESS_KEY_ID: "changeme"
  RAINLOGS_S3_SECRET_ACCESS_KEY: "changeme"
  RAINLOGS_JWT_SECRET: "0123456789abcdef0123456789abcdef" # Ensure 32 bytes
  RAINLOGS_KMS_KEY: "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef" # 32 bytes hex
